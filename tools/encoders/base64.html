<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Base64 Encoder/Decoder - ASDK Toolkit</title>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Inconsolata&display=swap" rel="stylesheet" />
        <link rel="stylesheet" href="../../css/app.css" />
        <style>
            body {
                height: 100vh;
                display: flex;
                flex-direction: column;
            }
            #main {
                flex: 1 1 auto;
                display: flex;
                flex-direction: row;
                overflow: hidden;
                padding: 0.75rem;
                gap: 0.5rem;
            }
            .pane {
                flex: 1 1 50%;
                min-width: 250px;
                border: 1px solid var(--bs-border-color);
                border-radius: 0.375rem;
                display: flex;
                flex-direction: column;
                overflow: hidden;
            }
            .pane textarea {
                flex: 1;
                border: none;
                resize: none;
                padding: 0.75rem;
                background: transparent;
                font-family: "Inconsolata", monospace;
                font-size: 0.95rem;
            }
            header,
            footer {
                padding: 0.5rem 0.75rem;
                border-bottom: 1px solid var(--bs-border-color);
            }
            footer {
                border-top: 1px solid var(--bs-border-color);
                border-bottom: none;
            }
            @media (max-width: 768px) {
                #main {
                    flex-direction: column;
                }
            }
        </style>
    </head>
    <body>
        <header class="d-flex align-items-center gap-3 flex-wrap">
            <h5 class="mb-0">
                <i class="bi bi-file-earmark-binary"></i>
                Base64 Tools
            </h5>

            <div class="ms-auto d-flex align-items-center gap-2 flex-wrap">
                <select class="form-select form-select-sm" id="encodingMode" style="width: 230px" title="Choose Base64 flavor">
                    <option value="standard">Standard Base64</option>
                    <option value="url">Base64 URL-safe (base64url)</option>
                </select>

                <select class="form-select form-select-sm" id="themeSelect" style="width: 130px" title="Select theme">
                    <option value="auto">Auto Theme</option>
                    <option value="light">Light Theme</option>
                    <option value="dark">Dark Theme</option>
                </select>
            </div>
        </header>

        <div id="main" class="container-fluid">
            <div id="leftPane" class="pane">
                <div class="px-3 py-2 border-bottom d-flex align-items-center justify-content-between">
                    <strong>Input</strong>
                    <small class="text-muted">Type or Paste Text / Base64 Here</small>
                </div>
                <textarea id="inputArea" placeholder="Enter text or Base64..." aria-label="Input text"></textarea>
            </div>

            <div id="rightPane" class="pane">
                <div class="px-3 py-2 border-bottom d-flex align-items-center justify-content-between">
                    <strong>Output</strong>
                    <small class="text-muted">Encoded Base64</small>
                </div>
                <textarea id="outputArea" placeholder="Output..." readonly aria-label="Output text"></textarea>
            </div>
        </div>

        <footer class="d-flex align-items-center flex-wrap">
            <div class="ms-auto d-flex gap-2 mt-2 mt-md-0">
                <button class="btn btn-outline-secondary btn-sm" id="swapBtn" title="Swap input and output"><i class="bi bi-arrow-left-right"></i> Swap</button>
                <button class="btn btn-outline-secondary btn-sm" id="clearBtn" title="Clear both panes"><i class="bi bi-trash"></i> Clear</button>
                <button class="btn btn-primary btn-sm" id="encodeBtn" title="Encode input to Base64" disabled><i class="bi bi-upload"></i> Encode</button>
                <button class="btn btn-primary btn-sm" id="decodeBtn" title="Decode Base64 to text" disabled><i class="bi bi-download"></i> Decode</button>
                <button class="btn btn-success btn-sm" id="copyBtn" title="Copy output to clipboard" disabled><i class="bi bi-clipboard"></i> Copy Output</button>
            </div>
        </footer>

        <div class="p-2 text-center small border-top">
            <i class="bi bi-arrow-left-circle pr-3 link-secondary"></i>
            <a href="https://theonlyasdk.github.io/asdk-toolkit" class="link-secondary" title="Go back to ASDK Toolkit"> Go back to ASDK Toolkit </a>
        </div>

        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            (($) => {
                // Theme handling
                const $theme = $("#themeSelect");
                function applyTheme(mode) {
                    if (mode === "auto") {
                        const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
                        document.body.setAttribute("data-bs-theme", prefersDark ? "dark" : "light");
                    } else {
                        document.body.setAttribute("data-bs-theme", mode);
                    }
                }
                const storedMode = localStorage.getItem("asdk-toolkit-theme") || "auto";
                $theme.val(storedMode);
                applyTheme(storedMode);
                $theme.on("change", function () {
                    const val = $(this).val();
                    localStorage.setItem("asdk-toolkit-theme", val);
                    applyTheme(val);
                });

                // Base64 helpers
                function uint8ToBase64(uint8) {
                    let res = "",
                        chunk = 0x8000,
                        i = 0;
                    while (i < uint8.length) {
                        const part = uint8.subarray(i, i + chunk);
                        res += String.fromCharCode.apply(null, part);
                        i += chunk;
                    }
                    return btoa(res);
                }
                function base64ToUint8(b64) {
                    const bin = atob(b64),
                        len = bin.length,
                        bytes = new Uint8Array(len);
                    for (let i = 0; i < len; i++) bytes[i] = bin.charCodeAt(i);
                    return bytes;
                }
                function encodeBase64(str, urlSafe) {
                    const enc = new TextEncoder().encode(str);
                    let b64 = uint8ToBase64(enc);
                    if (urlSafe) b64 = b64.replace(/\+/g, "-").replace(/\//g, "_").replace(/=+$/, "");
                    return b64;
                }
                function decodeBase64ToString(b64, urlSafe) {
                    if (urlSafe) {
                        b64 = b64.replace(/-/g, "+").replace(/_/g, "/");
                        const pad = b64.length % 4;
                        if (pad === 2) b64 += "==";
                        else if (pad === 3) b64 += "=";
                    }
                    const bytes = base64ToUint8(b64);
                    return new TextDecoder().decode(bytes);
                }

                const $in = $("#inputArea"),
                    $out = $("#outputArea"),
                    $mode = $("#encodingMode");
                const $encode = $("#encodeBtn"),
                    $decode = $("#decodeBtn"),
                    $copy = $("#copyBtn");

                function updateButtons() {
                    const txt = $in.val().trim();
                    const mode = $mode.val();
                    const b64pattern = mode === "url" ? /^[A-Za-z0-9\-_]+={0,2}$/ : /^[A-Za-z0-9+/]+={0,2}$/;
                    const looksB64 = b64pattern.test(txt) && txt.length >= 4;
                    $encode.prop("disabled", !txt);
                    $decode.prop("disabled", !looksB64);
                    $copy.prop("disabled", !$out.val().trim());
                }

                function autoEncode() {
                    const txt = $in.val();
                    if (!txt) {
                        $out.val("");
                        updateButtons();
                        return;
                    }
                    try {
                        $out.val(encodeBase64(txt, $mode.val() === "url"));
                    } catch (e) {
                        $out.val(`Error encoding: ${e.message}`);
                    }
                    updateButtons();
                }

                $in.on("input", autoEncode);
                $mode.on("change", autoEncode);

                $encode.on("click", () => {
                    try {
                        $out.val(encodeBase64($in.val(), $mode.val() === "url"));
                    } catch (e) {
                        $out.val("Error: " + e.message);
                    }
                    updateButtons();
                });
                $decode.on("click", () => {
                    try {
                        $out.val(decodeBase64ToString($in.val().trim(), $mode.val() === "url"));
                    } catch (e) {
                        $out.val("Error: " + e.message);
                    }
                    updateButtons();
                });
                $("#clearBtn").on("click", () => {
                    $in.val("");
                    $out.val("");
                    updateButtons();
                    $in.focus();
                });
                $("#swapBtn").on("click", () => {
                    const a = $in.val(),
                        b = $out.val();
                    $in.val(b);
                    $out.val(a);
                    autoEncode();
                });
                $copy.on("click", () => {
                    const txt = $out.val();
                    if (!txt) return;
                    navigator.clipboard.writeText(txt).then(() => {
                        const o = $copy.html();
                        $copy.html('<i class="bi bi-check-lg"></i> Copied');
                        setTimeout(() => {
                            $copy.html(o);
                        }, 1200);
                    });
                });

                updateButtons();
            })(jQuery);
        </script>
    </body>
</html>
